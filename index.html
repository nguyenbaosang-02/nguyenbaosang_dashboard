<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Create Product</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f8f9fa }
.table img { width:60px; height:60px; object-fit:cover; border-radius:8px }
</style>
</head>
<body>

<div class="container mt-5">
<h3 class="text-center mb-4">üì¶ Product Dashboard</h3>

<!-- CONTROLS ROW -->
<div class="row mb-3 align-items-center">
  <div class="col-md-4">
    <input class="form-control" placeholder="üîç Search by title...">
  </div>

  <div class="col-md-3">
    <select class="form-select">
      <option>5 / page</option>
      <option selected>10 / page</option>
      <option>20 / page</option>
    </select>
  </div>

  <div class="col-md-3 text-end">
    <button class="btn btn-primary" onclick="openCreateModal()">‚ûï Create</button>
  </div>
</div>

<!-- TABLE -->
<table class="table table-bordered table-hover align-middle">
<thead class="table-dark">
<tr>
  <th>ID</th>
  <th>Title</th>
  <th>Price</th>
  <th>Category</th>
  <th>Image</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

<!-- ===== CREATE PRODUCT MODAL ===== -->
<div class="modal fade" id="createModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Create Product</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <label class="form-label">Title</label>
            <input id="createTitle" class="form-control">
          </div>

          <div class="col-md-6">
            <label class="form-label">Price</label>
            <input id="createPrice" type="number" class="form-control">
          </div>
        </div>

        <div class="mt-3">
          <label class="form-label">Description</label>
          <textarea id="createDescription" class="form-control" rows="3"></textarea>
        </div>

        <div class="row mt-3">
          <div class="col-md-6">
            <label class="form-label">Category ID</label>
            <input id="createCategoryId" type="number" value="1" class="form-control">
          </div>

          <div class="col-md-6">
            <label class="form-label">Image URL</label>
            <input id="createImage" class="form-control"
                   value="https://placeimg.com/640/480/any">
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" onclick="createProduct()">Create</button>
      </div>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API = "https://api.escuelajs.co/api/v1/products";
let allProducts = [];
let createModalInstance;

// LOAD DATA
fetch(API)
  .then(res => res.json())
  .then(data => {
    allProducts = data;
    renderTable();
  });

// RENDER TABLE
function renderTable() {
  tbody.innerHTML = "";
  allProducts.forEach(p => {
    tbody.innerHTML += `
      <tr>
        <td>${p.id}</td>
        <td>${p.title}</td>
        <td>${p.price}</td>
        <td>${p.category?.name || ""}</td>
        <td>${p.images?.[0] ? `<img src="${p.images[0]}">` : ""}</td>
      </tr>
    `;
  });
}

// OPEN CREATE MODAL
function openCreateModal() {
  createModalInstance = new bootstrap.Modal(
    document.getElementById("createModal")
  );
  createModalInstance.show();
}

// CREATE PRODUCT (POST)
function createProduct() {
  const payload = {
    title: createTitle.value,
    price: Number(createPrice.value),
    description: createDescription.value,
    categoryId: Number(createCategoryId.value),
    images: [createImage.value]
  };

  fetch(API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(newProduct => {
    allProducts.unshift(newProduct);
    renderTable();
    createModalInstance.hide();
    alert("‚úÖ Product created successfully!");
  })
  .catch(() => alert("‚ùå Create failed"));
}
</script>

</body>
</html>
